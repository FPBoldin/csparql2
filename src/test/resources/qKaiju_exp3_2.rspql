PREFIX tr: <http://polimi.deib/tracing#>

REGISTER RSTREAM <s1> AS
SELECT (?tid AS ?traceId) (?sn2 AS ?serviceFrom) (?sn AS ?serviceTo) (COUNT(*) AS ?n_interactions)
FROM NAMED WINDOW <win> ON <jsonTraces> [RANGE PT10S STEP PT10S]
WHERE  {
    WINDOW <win> {
        ?s tr:reference ?s2 .
        ?s tr:spanId ?sid ;
            tr:spanOfProcess ?p .
        ?p tr:serviceName ?sn .
        ?s2 tr:spanOfTrace ?t ;
            tr:spanId ?sid2 ;
            tr:spanOfProcess ?p2 .
        ?t tr:traceId ?tid.
        ?p2 tr:serviceName ?sn2 .
    }
}
GROUP BY ?tid ?sn ?sn2
ORDER BY ?tid